<section id="dashboard">
  <h3>Dashboard</h3>
  <div class="card"><b>Total Budget:</b> â‚¹<span id="total-budget">0</span></div>
  <div class="card"><b>Total Expense:</b> â‚¹<span id="total-expense">0</span></div>
  <div class="card"><b>Remaining:</b> â‚¹<span id="remaining-budget">0</span></div>
  <div class="card">
    <b>Goal Progress:</b>
    <div class="progress-bar"><div id="goal-progress-bar" class="progress"></div></div>
    <span id="goal-progress-text"></span>
  </div>
  <div class="card">
    <b>Level & XP:</b>
    <div class="progress-bar"><div id="xp-progress" class="progress"></div></div>
    Level <span id="level">1</span> | XP <span id="xp">0</span>
  </div>
  <div class="card"><b>Streak:</b> <span id="streak">0 days</span></div>
  <h4>Recent Expenses</h4>
  <ul id="recent-expenses"></ul>
  <div id="badges"></div>
</section>

<section id="add-expense">
  <h3>Add Expense</h3>
  <form id="expense-form">
    <input id="expName" placeholder="Name" required>
    <input id="amount" type="number" placeholder="Amount (â‚¹)" required>
    <input id="date" type="date" required>
    <select id="category" required>
      <option value="">Category</option>
      <option>Food</option>
      <option>Transport</option>
      <option>Shopping</option>
      <option>Trading</option>
      <option>Room Rent</option>
      <option>Personal Need</option>
      <option>Others</option>
    </select>
    <select id="emotion" required>
      <option value="">Emotion</option>
      <option>ðŸ˜Š Happy</option>
      <option>ðŸ˜¢ Sad</option>
      <option>ðŸ˜« Stressed</option>
      <option>ðŸ¤© Excited</option>
      <option>ðŸ˜‚ Laugh</option>
      <option>ðŸ˜‹ Delicious</option>
    </select>
    <button type="submit">Add Expense</button>
  </form>
  <input type="text" id="search-expense" placeholder="Search...">
  <ul id="expense-list"></ul>
</section>

<section id="reports">
  <h3>Reports</h3>
  <div class="chart-container"><canvas id="categoryChart"></canvas></div>
  <div class="chart-container"><canvas id="monthlyChart"></canvas></div>
  <div class="chart-container"><canvas id="emotionChart"></canvas></div>
</section>

<section id="emotions">
  <h3>Emotion Analysis</h3>
  <p id="emotion-insight">Add expenses to see insights.</p>
</section>

<section id="settings">
  <h3>Settings</h3>
  <form id="budget-form">
    <input type="number" id="new-budget" placeholder="Set Budget (â‚¹)">
    <input type="number" id="goal-amount" placeholder="Set Goal (â‚¹)">
    <button type="submit">Save</button>
  </form>
  <button id="export-btn">Export CSV</button>
  <button id="reset-btn">Reset Data</button>
</section>

</main>

<script>
let expenses=JSON.parse(localStorage.getItem('expenses'))||[];
let totalBudget=parseFloat(localStorage.getItem('budget'))||50000;
let goalAmount=parseFloat(localStorage.getItem('goalAmount'))||10000;
let streakDays=parseInt(localStorage.getItem('streakDays'))||0;
let lastDate=localStorage.getItem('lastDate')||null;
let xp=parseInt(localStorage.getItem('xp'))||0;
let level=parseInt(localStorage.getItem('level'))||1;
let badges=JSON.parse(localStorage.getItem('badges'))||[];
let categoryChart,monthlyChart,emotionChart;

function toggleMenu(){document.getElementById('nav-links').classList.toggle('show');}
function jumpTo(id){
  const section=document.getElementById(id);
  section.scrollIntoView({behavior:'smooth'});
  section.style.transform='translateY(-10px)';
  setTimeout(()=>section.style.transform='translateY(0)',300);
  document.querySelectorAll('nav ul li a').forEach(a=>a.classList.remove('active'));
  document.querySelector(`nav ul li a[onclick="jumpTo('${id}')"]`).classList.add('active');
  if(id==='dashboard') updateDashboard();
  if(id==='reports') updateCharts();
  if(id==='emotions') updateEmotionAnalysis();
  if(window.innerWidth<768) toggleMenu();
}

document.getElementById('expense-form').addEventListener('submit',e=>{
  e.preventDefault();

  const nameInput=document.getElementById('expName');
  const amountInput=document.getElementById('amount');
  const dateInput=document.getElementById('date');
  const categoryInput=document.getElementById('category');
  const emotionInput=document.getElementById('emotion');

  if(!nameInput.value||!amountInput.value||!dateInput.value||!categoryInput.value||!emotionInput.value){
    alert("Please fill all fields before adding an expense!");
    return;
  }

  const exp={
    name:nameInput.value.trim(),
    amount:parseFloat(amountInput.value),
    date:dateInput.value,
    category:categoryInput.value,
    emotion:emotionInput.value
  };

  expenses.push(exp);
  addXP(10);
  saveData();
  renderExpenses();
  updateDashboard();
  updateCharts();
  updateEmotionAnalysis();
  e.target.reset();
});

function renderExpenses(){
  let list=document.getElementById('expense-list'); list.innerHTML='';
  let recent=document.getElementById('recent-expenses'); recent.innerHTML='';
  expenses.slice().reverse().forEach((e,i)=>{
    let li=document.createElement('li');
    li.innerHTML=`${e.date} | ${e.name} | â‚¹${e.amount} | ${e.category} | ${e.emotion}`;
    let btn=document.createElement('button');
    btn.textContent='Delete'; btn.className='delete-btn';
    btn.onclick=()=>{expenses.splice(expenses.indexOf(e),1);saveData();renderExpenses();updateDashboard();updateCharts();updateEmotionAnalysis();};
    li.appendChild(btn); list.appendChild(li);
    if(i<5){let li2=document.createElement('li');li2.textContent=li.textContent;recent.appendChild(li2);}
  });
}
document.getElementById('search-expense').addEventListener('input',e=>{
  let q=e.target.value.toLowerCase();
  document.querySelectorAll('#expense-list li').forEach(li=>li.style.display=li.textContent.toLowerCase().includes(q)?'flex':'none');
});

function updateDashboard(){
  let total=expenses.reduce((a,b)=>a+b.amount,0);
  document.getElementById('total-budget').textContent=totalBudget;
  document.getElementById('total-expense').textContent=total;
  document.getElementById('remaining-budget').textContent=totalBudget-total;
  let progress=Math.min((total/goalAmount)*100,100);
  document.getElementById('goal-progress-bar').style.width=progress+'%';
  document.getElementById('goal-progress-text').textContent=`â‚¹${total} / â‚¹${goalAmount}`;
  let today=new Date().toISOString().split('T')[0];
  if(lastDate===today){} else if(lastDate===new Date(Date.now()-86400000).toISOString().split('T')[0]){streakDays++;awardBadge('Streak Master');} else{streakDays=1;}
  lastDate=today; document.getElementById('streak').textContent=streakDays+' days';
  document.getElementById('xp').textContent=xp; document.getElementById('level').textContent=level;
  document.getElementById('xp-progress').style.width=Math.min((xp/(level*50))*100,100)+'%';
  checkGoal(total); displayBadges(); saveData();
}

function updateCharts(){
  let ctx1=document.getElementById('categoryChart').getContext('2d');
  let ctx2=document.getElementById('monthlyChart').getContext('2d');
  let ctx3=document.getElementById('emotionChart').getContext('2d');
  if(categoryChart) categoryChart.destroy();
  if(monthlyChart) monthlyChart.destroy();
  if(emotionChart) emotionChart.destroy();
  let catMap={},monthMap={},emoMap={};
  expenses.forEach(e=>{catMap[e.category]=(catMap[e.category]||0)+e.amount;monthMap[e.date.substring(0,7)]=(monthMap[e.date.substring(0,7)]||0)+e.amount;emoMap[e.emotion]=(emoMap[e.emotion]||0)+1;});
  categoryChart=new Chart(ctx1,{type:'pie',data:{labels:Object.keys(catMap),datasets:[{data:Object.values(catMap),backgroundColor:['#a5d8ff','#c4f1f9','#b5ead7','#d6c6f5']}]}});  
  monthlyChart=new Chart(ctx2,{type:'bar',data:{labels:Object.keys(monthMap),datasets:[{data:Object.values(monthMap),backgroundColor:'#c4f1f9'}]}});  
  emotionChart=new Chart(ctx3,{type:'doughnut',data:{labels:Object.keys(emoMap),datasets:[{data:Object.values(emoMap),backgroundColor:['#a5d8ff','#c4f1f9','#b5ead7','#d6c6f5','#d1d5db']}]}});  
}

function updateEmotionAnalysis(){
  let emoSpend={}; expenses.forEach(e=>{emoSpend[e.emotion]=(emoSpend[e.emotion]||0)+e.amount;});
  let top=Object.entries(emoSpend).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById('emotion-insight').textContent=top?`You spend the most when feeling ${top[0]}`:'Add expenses to see insights.';
}

document.getElementById('budget-form').addEventListener('submit',e=>{
  e.preventDefault();
  totalBudget=parseFloat(document.getElementById('new-budget').value)||totalBudget;
  goalAmount=parseFloat(document.getElementById('goal-amount').value)||goalAmount;
  saveData(); updateDashboard(); e.target.reset();
});
document.getElementById('export-btn').addEventListener('click',()=>{
  let csv='Date,Name,Amount,Category,Emotion\n';
  expenses.forEach(e=>{csv+=`${e.date},${e.name},${e.amount},${e.category},${e.emotion}\n`;});
  let blob=new Blob([csv],{type:'text/csv'}); let a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='expenses.csv'; a.click();
});
document.getElementById('reset-btn').addEventListener('click',()=>{
  if(confirm('Reset all data?')){
    expenses=[]; totalBudget=50000; goalAmount=10000; streakDays=0; lastDate=null; xp=0; level=1; badges=[];
    saveData(); renderExpenses(); updateDashboard(); updateCharts(); updateEmotionAnalysis();
  }
});

function saveData(){
  localStorage.setItem('expenses',JSON.stringify(expenses));
  localStorage.setItem('budget',totalBudget);
  localStorage.setItem('goalAmount',goalAmount);
  localStorage.setItem('streakDays',streakDays);
  localStorage.setItem('lastDate',lastDate);
  localStorage.setItem('xp',xp);
  localStorage.setItem('level',level);
  localStorage.setItem('badges',JSON.stringify(badges));
}

function addXP(amount){xp+=amount;while(xp>=level*50){xp-=level*50;level++;awardBadge('Level Up');showConfetti();}updateDashboard();}
function awardBadge(name){if(!badges.includes(name)){badges.push(name);showConfetti();}}
function displayBadges(){let container=document.getElementById('badges'); container.innerHTML=''; badges.forEach(b=>{let span=document.createElement('span');span.className='badge';span.textContent=b;container.appendChild(span);});}
function showConfetti(){for(let i=0;i<50;i++){let div=document.createElement('div');div.className='confetti';div.style.backgroundColor=`hsl(${Math.random()*360},70%,70%)`;div.style.left=Math.random()*window.innerWidth+'px';div.style.animationDuration=2+Math.random()*2+'s';document.body.appendChild(div);setTimeout(()=>div.remove(),3000);}}
function checkGoal(total){if(total>=goalAmount){awardBadge('Goal Achiever');}}

renderExpenses(); updateDashboard(); updateCharts(); updateEmotionAnalysis(); displayBadges();
</script>
</body>
</html>
